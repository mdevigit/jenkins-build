# Start with an Alpine base image
FROM alpine:3.20 as build

# Install necessary dependencies
RUN apk update && apk add --no-cache nodejs npm && \
    rm -rf /var/cache/apk/*

# Set working directory
WORKDIR /app

# Copy the application code
COPY frontend/ ./

# Install dependencies
RUN npm install --force

# Build the React app
RUN npm run build

# Use a smaller base image for serving the application
FROM alpine:3.20

# Set working directory
WORKDIR /app

# Copy the build output from the build stage
COPY --from=build /app/build ./build

# Install serve to serve the application and nodejs for compatibility
RUN apk update && apk add --no-cache nodejs npm && \
    npm install -g serve && \
    rm -rf /var/cache/apk/*

# Command to run the server
CMD ["serve", "-s", "build"]

